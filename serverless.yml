service: dynamic-pricing-service

frameworkVersion: '3'
useDotenv: true
plugins:
  - serverless-offline
  - serverless-dotenv-plugin

provider:
  name: aws
  region: ap-northeast-2
  profile: dev
  architecture: x86_64
  environment:
    ENV: ${env:ENV}
    ECR_URI: ${env:ECR_URI}
    DATABASE_URL: ${env:DATABASE_URL}
    PRISMA_CLI_BINARY_TARGETS: native,rhel-openssl-1.0.x # 추가
  ecr:
    images:
      dynamic-pricing-image:
        path: ./

functions:
  app:
    memorySize: 512
    timeout: 29
    image:
      uri: ${env:ECR_URI}
      command:
        - '/app/dist/lambda.handler'
    events:
      - httpApi:
          method: '*'
          path: '*'
      - schedule:
          name: morningScrapping
          description: 'Trigger scrapping at 11 AM every day'
          rate: cron(49 3 * * ? *)
          enabled: true
      - schedule:
          name: eveningScrapping
          description: 'Trigger scrapping at 8 PM every day'
          rate: cron(0 20 * * ? *)
          enabled: true

# 추가된 부분
package:
  patterns:
    - '!node_modules/.prisma/client/libquery_engine-*'
    - 'node_modules/.prisma/client/libquery_engine-rhel-*'
    - '!node_modules/prisma/libquery_engine-*'
    - '!node_modules/@prisma/engines/**'
